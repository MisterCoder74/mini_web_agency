<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Verifica Account</title>
<style>
body {
font-family: Arial, sans-serif;
background-color: #f9f9f9;
padding: 30px;
}
.container {
max-width: 400px;
margin: 0 auto;
background: white;
border-radius: 6px;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
padding: 20px;
}
input {
width: 100%;
margin-bottom: 10px;
padding: 10px;
box-sizing: border-box;
}
button {
width: 100%;
padding: 10px;
background-color: #007bff;
border: none;
color: white;
border-radius: 4px;
cursor: pointer;
font-size: 16px;
}
button:hover {
background-color: #0056b3;
}
.msg {
margin-top: 10px;
color: #333;
font-size: 14px;
}
</style>
</head>
<body>
<div class="container">
<h3>Verifica il tuo account</h3>
<p>Inserisci qui la tua email e il codice ricevuto via email per attivare l'account.</p>

<input type="email" id="email" placeholder="La tua email" required>
<input type="text" id="otp" placeholder="Codice OTP" required>
<button onclick="verify()">Verifica</button>

<p class="msg" id="message"></p>
</div>

<script>
// Precompila l'email se salvata dopo la registrazione
window.addEventListener('DOMContentLoaded', () => {
const savedEmail = localStorage.getItem('pendingEmail');
if (savedEmail) {
document.getElementById('email').value = savedEmail;
}
});

async function verify() {
const email = document.getElementById('email').value.trim();
const otp = document.getElementById('otp').value.trim();
const messageBox = document.getElementById('message');

if (!email || !otp) {
messageBox.textContent = 'Compila tutti i campi.';
return;
}

const res = await fetch('api.php', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ action: 'verifyOtp', email, otp })
});

const data = await res.json();
messageBox.textContent = data.message;

if (data.success) {
// âœ… Attivazione riuscita: rimuove l'email salvata e reindirizza
localStorage.removeItem('pendingEmail');
alert('Account verificato! Puoi ora effettuare il login.');
window.location.href = 'index.html'; // redirect al login principale
}
}
</script>
</body>
</html>