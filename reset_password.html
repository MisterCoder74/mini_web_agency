<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Reimposta Password</title>
<style>
body {
font-family: Arial, sans-serif;
padding: 30px;
background: #f9f9f9;
}
.container {
max-width: 400px;
margin: 0 auto;
background: white;
border-radius: 6px;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
padding: 20px;
}
input {
width: 100%;
margin-bottom: 10px;
padding: 10px;
box-sizing: border-box;
}
button {
width: 100%;
padding: 10px;
cursor: pointer;
background-color: #007bff;
border: none;
color: white;
border-radius: 4px;
font-size: 16px;
}
button:hover {
background-color: #0056b3;
}
.msg {
margin-top: 10px;
color: #333;
font-size: 14px;
}
</style>
</head>
<body>
<div class="container">
<h3>Hai dimenticato la password?</h3>
<p>Inserisci la tua email: ti invieremo un codice di verifica (OTP).</p>

<input type="email" id="email" placeholder="La tua email" required>
<button onclick="sendOtp()">Invia codice</button>

<div id="otpSection" style="display:none; margin-top:20px;">
<h4>Reimposta la password</h4>
<input type="text" id="otp" placeholder="Codice OTP ricevuto via email" required>
<input type="password" id="newPassword" placeholder="Nuova password (min. 8 caratteri)" required>
<button onclick="resetPassword()">Conferma nuova password</button>
</div>

<p class="msg" id="message"></p>
</div>

<script>
async function sendOtp() {
const email = document.getElementById('email').value;
if (!email) return alert('Inserisci la tua email.');

const res = await fetch('api.php', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ action: 'forgotPassword', email })
});

const data = await res.json();
document.getElementById('message').textContent = data.message;

if (data.success) {
document.getElementById('otpSection').style.display = 'block';
}
}

async function resetPassword() {
const email = document.getElementById('email').value;
const otp = document.getElementById('otp').value;
const password = document.getElementById('newPassword').value;

if (!email || !otp || !password)
return alert('Compila tutti i campi.');

const res = await fetch('api.php', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ action: 'resetPassword', email, otp, password })
});

const data = await res.json();
document.getElementById('message').textContent = data.message;

if (data.success) {
alert('Password aggiornata con successo! Ora puoi accedere.');
window.location.href = 'index.html';
}
}
</script>
</body>
</html>